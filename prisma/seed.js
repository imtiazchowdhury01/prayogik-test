import { PrismaClient } from "@prisma/client";
const db = new PrismaClient();

// ------------------ Seed Category ------------------
// const categoryData = [
//   { name: "‡¶è‡¶∏‡¶á‡¶ì", slug: "seo" },
//   { name: "‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü‡¶ø‡¶Ç", slug: "digital-marketing" },
//   { name: "‡¶ó‡ßç‡¶∞‡¶æ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®", slug: "graphics-design" },
//   { name: "‡¶ì‡ßü‡ßá‡¶¨ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶ì ‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶Æ‡ßá‡¶®‡ßç‡¶ü", slug: "web-design-development" },
//   { name: "‡¶ï‡¶®‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶æ‡¶ü‡ßá‡¶ú‡¶ø", slug: "content-strategy" },
//   { name: "UI/UX ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®", slug: "uiux-design" },
//   { name: "‡¶è‡¶®‡ßç‡¶°‡ßç‡¶∞‡ßã‡¶á‡¶° ‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶Æ‡ßá‡¶®‡ßç‡¶ü", slug: "android-development" },
//   { name: "‡¶∏‡ßã‡¶∂‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶Æ‡¶ø‡¶°‡¶ø‡¶Ø‡¶º‡¶æ", slug: "social-media" },
//   { name: "‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü‡¶ø‡¶Ç", slug: "content-marketing" },
//   { name: "‡¶á-‡¶ï‡¶Æ‡¶æ‡¶∞‡ßç‡¶∏", slug: "ecommerce" },
//   { name: "‡¶¨‡¶ø‡¶ú‡¶®‡ßá‡¶∏", slug: "business" },
//   { name: "‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶≤‡¶ø‡¶ü‡¶ø‡¶ï‡ßç‡¶∏", slug: "data-analytics" },
// ];

// export async function seedCategory() {
//   console.log("Seeding categories...");

//   try {
//     // Loop through the data and upsert each category
//     for (const category of categoryData) {
//       await db.category.upsert({
//         where: { slug: category.slug }, // Use `slug` as the unique identifier
//         update: { name: category.name }, // Update the name if the category exists
//         create: category, // Create the category if it doesn't exist
//       });

//       console.log(`Upserted category with slug: ${category.slug}`);
//     }

//     console.log("‚úî Categories seeded successfully!üî•");
//   } catch (error) {
//     console.error("Error seeding the database categories", error);
//     throw error; // Re-throw the error to handle it in the seed.ts file
//   } finally {
//     await db.$disconnect();
//   }
// }

const categoryData = [
  // 1. Digital Marketing (Parent)
  {
    name: "‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü‡¶ø‡¶Ç",
    slug: "digital-marketing",
    isChild: false,
    childCategories: [
      { name: "‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶á‡¶û‡ßç‡¶ú‡¶ø‡¶® ‡¶Ö‡¶™‡ßç‡¶ü‡¶ø‡¶Æ‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶® (SEO)", slug: "seo", isChild: true },
      {
        name: "‡¶∏‡ßã‡¶∂‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶Æ‡¶ø‡¶°‡¶ø‡¶Ø‡¶º‡¶æ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü‡¶ø‡¶Ç (SMM)",
        slug: "social-media-marketing",
        isChild: true,
      },
      { name: "‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü‡¶ø‡¶Ç", slug: "content-marketing", isChild: true },
      { name: "‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü‡¶ø‡¶Ç", slug: "email-marketing", isChild: true },
      { name: "‡¶ï‡¶®‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶æ‡¶ü‡ßá‡¶ú‡¶ø", slug: "content-strategy", isChild: true },
      {
        name: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶´‡¶ø‡¶≤‡¶ø‡¶Ø‡¶º‡ßá‡¶ü ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü‡¶ø‡¶Ç",
        slug: "affiliate-marketing",
        isChild: true,
      },
    ],
  },

  // 2. Web Development (Parent)
  {
    name: "‡¶ì‡¶Ø‡¶º‡ßá‡¶¨ ‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶Æ‡ßá‡¶®‡ßç‡¶ü",
    slug: "web-development",
    isChild: false,
    childCategories: [
      {
        name: "‡¶´‡ßç‡¶∞‡¶®‡ßç‡¶ü-‡¶è‡¶®‡ßç‡¶° ‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶Æ‡ßá‡¶®‡ßç‡¶ü",
        slug: "frontend-development",
        isChild: true,
      },
      {
        name: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï-‡¶è‡¶®‡ßç‡¶° ‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶Æ‡ßá‡¶®‡ßç‡¶ü",
        slug: "backend-development",
        isChild: true,
      },
      {
        name: "‡¶´‡ßÅ‡¶≤-‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ï ‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶Æ‡ßá‡¶®‡ßç‡¶ü",
        slug: "fullstack-development",
        isChild: true,
      },
      {
        name: "‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°‡¶™‡ßç‡¶∞‡ßá‡¶∏ ‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶Æ‡ßá‡¶®‡ßç‡¶ü",
        slug: "wordpress-development",
        isChild: true,
      },
      {
        name: "‡¶ì‡ßü‡ßá‡¶¨ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶ì ‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶Æ‡ßá‡¶®‡ßç‡¶ü",
        slug: "web-design-development",
        isChild: true,
      },
    ],
  },

  // 3. Design (Parent)
  {
    name: "‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®",
    slug: "design",
    isChild: false,
    childCategories: [
      { name: "‡¶ó‡ßç‡¶∞‡¶æ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®", slug: "graphics-design", isChild: true },
      { name: "UI/UX ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®", slug: "uiux-design", isChild: true },
      { name: "‡¶≤‡ßã‡¶ó‡ßã ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®", slug: "logo-design", isChild: true },
      { name: "‡¶ì‡¶Ø‡¶º‡ßá‡¶¨ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®", slug: "web-design", isChild: true },
      {
        name: "‡¶Æ‡ßã‡¶∂‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®",
        slug: "motion-graphics-design",
        isChild: true,
      },
      { name: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶®", slug: "animation", isChild: true },
      { name: "‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶è‡¶°‡¶ø‡¶ü‡¶ø‡¶Ç", slug: "video-editing", isChild: true },
    ],
  },

  // 4. Standalone Categories (No parent)
  {
    name: "‡¶è‡¶®‡ßç‡¶°‡ßç‡¶∞‡ßã‡¶á‡¶° ‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶Æ‡ßá‡¶®‡ßç‡¶ü",
    slug: "android-development",
    isChild: false,
  },
  {
    name: "‡¶∏‡ßã‡¶∂‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶Æ‡¶ø‡¶°‡¶ø‡¶Ø‡¶º‡¶æ",
    slug: "social-media",
    isChild: false,
  },
  {
    name: "‡¶¨‡¶ø‡¶ú‡¶®‡ßá‡¶∏",
    slug: "business",
    isChild: false,
  },
  {
    name: "‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶≤‡¶ø‡¶ü‡¶ø‡¶ï‡ßç‡¶∏",
    slug: "data-analytics",
    isChild: false,
  },
];

export async function seedCategory() {
  console.log("Seeding categories...");

  try {
    // First create parent categories
    for (const category of categoryData) {
      if (!category.childCategories) {
        // Handle standalone categories
        await db.category.upsert({
          where: { slug: category.slug },
          update: { name: category.name, isChild: category.isChild },
          create: category,
        });
        console.log(`Upserted standalone category: ${category.slug}`);
        continue;
      }

      // Handle parent categories with children
      const { childCategories, ...parentData } = category;

      const parent = await db.category.upsert({
        where: { slug: parentData.slug },
        update: { name: parentData.name, isChild: parentData.isChild },
        create: parentData,
      });

      console.log(`Upserted parent category: ${parentData.slug}`);

      // Create child categories
      for (const child of childCategories) {
        await db.category.upsert({
          where: { slug: child.slug },
          update: {
            ...child,
            parentCategory: { connect: { id: parent.id } },
          },
          create: {
            ...child,
            parentCategory: { connect: { id: parent.id } },
          },
        });
        console.log(
          `Upserted child category: ${child.slug} under ${parentData.slug}`
        );
      }
    }

    console.log("‚úî Categories seeded successfully!");
  } catch (error) {
    console.error("Error seeding categories:", error);
    throw error;
  } finally {
    await db.$disconnect();
  }
}

// ------------------ Seed Rank ------------------
const rankData = [
  {
    name: "Three Star",
    description:
      "Three star ranked teacher will get 25% share of revenue from course sell",
    numberOfSales: 1,
    feePercentage: 25,
  },
  {
    name: "Five Star",
    description:
      "Five star ranked teacher will get 30% share of revenue from course sell",
    numberOfSales: 5,
    feePercentage: 30,
  },
  {
    name: "Seven Star",
    description:
      "Seven star ranked teacher will get 40% share of revenue from course sell",
    numberOfSales: 10,
    feePercentage: 40,
  },
];

export async function seedRank() {
  console.log("Seeding ranks...");

  try {
    // Loop through the data and upsert each rank
    for (const rank of rankData) {
      await db.teacherRank.upsert({
        where: { name: rank.name }, // Use `name` as the unique identifier
        update: { ...rank }, // Update with the new data if it exists
        create: { ...rank }, // Create with the new data if it doesn't exist
      });
    }

    console.log("‚úî Ranks seeded successfully!üî•");
  } catch (error) {
    console.error("Error seeding the database ranks", error);
    throw error; // Re-throw the error to handle it in the seed.ts file
  } finally {
    await db.$disconnect();
  }
}

// ------------------ Seed Discount ------------------
const discountData = [
  {
    name: "Default",
    discountPercentage: 70,
    isDefault: true,
  },
];

export async function seedDiscount() {
  console.log("Seeding membership course price discount...");

  try {
    // Loop through the data and upsert each discount
    for (const discount of discountData) {
      await db.subscriptionDiscount.upsert({
        where: { name: discount.name }, // Use `name` as the unique identifier
        update: { ...discount }, // Update with the new data if it exists
        create: { ...discount }, // Create with the new data if it doesn't exist
      });

      console.log(`Upserted discount with name: ${discount.name}`);
    }

    console.log("‚úî Membership course price discount seeded successfully!üî•");
  } catch (error) {
    console.error("Error seeding membership course price discount", error);
    throw error; // Re-throw the error to handle it in the seed.ts file
  } finally {
    await db.$disconnect();
  }
}

// ------------------ Seed Subscription Plan ------------------
// const subscriptionPlanData = [
//   {
//     name: "‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶Æ",
//     type: "YEARLY",
//     regularPrice: 3500,
//     isDefault: true,
//   },
// ];

// export async function seedSubscriptionPlan() {
//   console.log("Seeding subscription plans...");

//   try {
//     // Find the "Default" discount first
//     const defaultDiscount = await db.subscriptionDiscount.findFirst({
//       where: { isDefault: true },
//     });

//     if (!defaultDiscount) {
//       throw new Error("Default discount not found in the database.");
//     }

//     // Loop through the data and upsert each subscription plan
//     for (const plan of subscriptionPlanData) {
//       const createdOrUpdatedPlan = await db.subscriptionPlan.upsert({
//         where: { name: plan.name }, // Use the plan name directly
//         update: {
//           type: plan.type,
//           regularPrice: plan.regularPrice,
//           isDefault: plan.isDefault,
//           subscriptionDiscountId: defaultDiscount.id,
//         },
//         create: {
//           ...plan,
//           subscriptionDiscountId: defaultDiscount.id,
//         },
//       });

//       console.log({ createdOrUpdatedPlan });
//       console.log(`Upserted subscription plan with name: ${plan.name}`);
//     }

//     console.log("‚úî Subscription plans seeded successfully!üî•");
//   } catch (error) {
//     console.error("Error seeding the database subscription plans", error);
//     throw error; // Re-throw the error to handle it in the seed.ts file
//   } finally {
//     await db.$disconnect();
//   }
// }

const subscriptionPlanData = [
  {
    name: "‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶Æ",
    type: "YEARLY",
    regularPrice: 3500,
    isDefault: true,
  },
];

export async function seedSubscriptionPlan() {
  console.log("Seeding subscription plans...");
  try {
    // Find the default discount first
    const defaultDiscount = await db.subscriptionDiscount.findFirst({
      where: { isDefault: true },
    });
    if (!defaultDiscount) {
      console.log("‚ö† No default discount found");
      return;
    }

    // Find the default subscription plan if it exists
    const defaultPlan = subscriptionPlanData.find((plan) => plan.isDefault);

    // Alternative approach: Use findFirst + create/update pattern
    const existingPlan = await db.subscriptionPlan.findFirst({
      where: { isDefault: true },
    });

    let createdOrUpdatedPlan;

    if (existingPlan) {
      // Update existing plan
      createdOrUpdatedPlan = await db.subscriptionPlan.update({
        where: { id: existingPlan.id },
        data: {
          name: defaultPlan.name,
          type: defaultPlan.type,
          regularPrice: defaultPlan.regularPrice,
          subscriptionDiscountId: defaultDiscount.id,
        },
      });
    } else {
      // Create new plan
      createdOrUpdatedPlan = await db.subscriptionPlan.create({
        data: {
          ...defaultPlan,
          subscriptionDiscountId: defaultDiscount.id,
        },
      });
    }

    console.log({ createdOrUpdatedPlan });
    console.log(`Upserted subscription plan with name: ${defaultPlan.name}`);
    console.log("‚úî Subscription plans seeded successfully!üî•");
  } catch (error) {
    console.error("Error seeding the database subscription plans", error);
    throw error;
  } finally {
    await db.$disconnect();
  }
}

// ------------------ Seed Users ------------------
// const userData = [
//   {
//     name: process.env.E2E_TEACHER_NAME,
//     username: process.env.E2E_TEACHER_USERNAME,
//     email: process.env.E2E_TEACHER_EMAIL,
//     emailVerified: true,
//     isAdmin: false,
//     isSuperAdmin: false,
//     role: "TEACHER",
//     accountStatus: "ACTIVE",
//     password: process.env.E2E_USER_PASSWORD, // 123456
//   },
//   {
//     name: process.env.E2E_STUDENT_NAME,
//     username: process.env.E2E_STUDENT_USERNAME,
//     email: process.env.E2E_STUDENT_EMAIL,
//     emailVerified: true,
//     isAdmin: false,
//     isSuperAdmin: false,
//     role: "STUDENT",
//     accountStatus: "ACTIVE",
//     password: process.env.E2E_USER_PASSWORD, // 123456
//   },
//   {
//     name: process.env.E2E_ADMIN_NAME,
//     username: process.env.E2E_ADMIN_USERNAME,
//     email: process.env.E2E_ADMIN_EMAIL,
//     emailVerified: true,
//     isAdmin: true,
//     isSuperAdmin: false,
//     role: "ADMIN",
//     accountStatus: "ACTIVE",
//     password: process.env.E2E_USER_PASSWORD, // 123456
//   },
// ];

// export async function seedUsers() {
//   console.log("Seeding users...");

//   try {
//     // Loop through the data and upsert each user
//     for (const user of userData) {
//       await db.user.upsert({
//         where: { email: user.email },
//         update: {
//           ...user,
//           updatedAt: new Date(),
//         },
//         create: {
//           ...user,
//           createdAt: new Date(),
//           updatedAt: new Date(),
//         },
//       });

//       console.log(`Upserted user with email: ${user.email}`);
//     }

//     console.log("‚úî Users seeded successfully!üî•");
//   } catch (error) {
//     console.error("Error seeding users", error);
//     throw error;
//   } finally {
//     await db.$disconnect();
//   }
// }

// Seed All
async function seedAll() {
  try {
    console.log("Starting seeding process...");
    // await seedUsers();
    await seedCategory();
    await seedRank();
    await seedDiscount();
    await seedSubscriptionPlan();

    console.log("‚úî All seeding completed successfully!üî•");
  } catch (error) {
    console.error("Error during seeding:", error);
  }
}

// Run the seed function
seedAll();
